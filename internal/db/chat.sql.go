// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: chat.sql

package db

import (
	"context"
)

const deleteChat = `-- name: DeleteChat :exec
DELETE FROM
    chat
WHERE
    id = ?
`

func (q *Queries) DeleteChat(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, deleteChat, id)
	return err
}

const deleteTag = `-- name: DeleteTag :exec
DELETE FROM
    chat_tag
WHERE
    chat_id = ?
    AND name = ?
`

type DeleteTagParams struct {
	ChatID string
	Name   string
}

func (q *Queries) DeleteTag(ctx context.Context, arg DeleteTagParams) error {
	_, err := q.db.ExecContext(ctx, deleteTag, arg.ChatID, arg.Name)
	return err
}

const findChat = `-- name: FindChat :one
SELECT
    title,
    messages
FROM
    chat
WHERE
    id = ?
`

type FindChatRow struct {
	Title    string
	Messages []byte
}

func (q *Queries) FindChat(ctx context.Context, id string) (FindChatRow, error) {
	row := q.db.QueryRowContext(ctx, findChat, id)
	var i FindChatRow
	err := row.Scan(&i.Title, &i.Messages)
	return i, err
}

const findChatBranch = `-- name: FindChatBranch :one
SELECT
    messages
FROM
    chat_branch
WHERE
    chat_id = ?
    AND id = ?
`

type FindChatBranchParams struct {
	ChatID string
	ID     string
}

func (q *Queries) FindChatBranch(ctx context.Context, arg FindChatBranchParams) ([]byte, error) {
	row := q.db.QueryRowContext(ctx, findChatBranch, arg.ChatID, arg.ID)
	var messages []byte
	err := row.Scan(&messages)
	return messages, err
}

const findChatTitles = `-- name: FindChatTitles :many
SELECT
    id,
    title
FROM
    chat
`

type FindChatTitlesRow struct {
	ID    string
	Title string
}

func (q *Queries) FindChatTitles(ctx context.Context) ([]FindChatTitlesRow, error) {
	rows, err := q.db.QueryContext(ctx, findChatTitles)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []FindChatTitlesRow
	for rows.Next() {
		var i FindChatTitlesRow
		if err := rows.Scan(&i.ID, &i.Title); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const findTags = `-- name: FindTags :many
SELECT
    name
FROM
    chat_tag
WHERE
    chat_id = ?
`

func (q *Queries) FindTags(ctx context.Context, chatID string) ([]string, error) {
	rows, err := q.db.QueryContext(ctx, findTags, chatID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []string
	for rows.Next() {
		var name string
		if err := rows.Scan(&name); err != nil {
			return nil, err
		}
		items = append(items, name)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const saveChat = `-- name: SaveChat :exec
INSERT INTO
    chat (id, title, messages)
VALUES
    (?, ?, ?) ON conflict DO
UPDATE
SET
    title = excluded.title,
    messages = excluded.messages,
    updated_at = unixepoch()
`

type SaveChatParams struct {
	ID       string
	Title    string
	Messages []byte
}

func (q *Queries) SaveChat(ctx context.Context, arg SaveChatParams) error {
	_, err := q.db.ExecContext(ctx, saveChat, arg.ID, arg.Title, arg.Messages)
	return err
}

const saveChatTitle = `-- name: SaveChatTitle :exec
UPDATE
    chat
SET
    title = ?,
    updated_at = unixepoch()
WHERE
    id = ?
`

type SaveChatTitleParams struct {
	Title string
	ID    string
}

func (q *Queries) SaveChatTitle(ctx context.Context, arg SaveChatTitleParams) error {
	_, err := q.db.ExecContext(ctx, saveChatTitle, arg.Title, arg.ID)
	return err
}

const saveMention = `-- name: SaveMention :exec
INSERT INTO
    mention(target_id, source_id)
VALUES
    (?, ?) ON CONFLICT(target_id, source_id) DO NOTHING
`

type SaveMentionParams struct {
	TargetID string
	SourceID string
}

func (q *Queries) SaveMention(ctx context.Context, arg SaveMentionParams) error {
	_, err := q.db.ExecContext(ctx, saveMention, arg.TargetID, arg.SourceID)
	return err
}

const saveTag = `-- name: SaveTag :exec
INSERT INTO
    chat_tag (chat_id, name)
VALUES
    (?, ?)
`

type SaveTagParams struct {
	ChatID string
	Name   string
}

func (q *Queries) SaveTag(ctx context.Context, arg SaveTagParams) error {
	_, err := q.db.ExecContext(ctx, saveTag, arg.ChatID, arg.Name)
	return err
}

const updateChatMessages = `-- name: UpdateChatMessages :exec
UPDATE
    chat
SET
    messages = ?,
    updated_at = unixepoch()
WHERE
    id = ?
`

type UpdateChatMessagesParams struct {
	Messages []byte
	ID       string
}

func (q *Queries) UpdateChatMessages(ctx context.Context, arg UpdateChatMessagesParams) error {
	_, err := q.db.ExecContext(ctx, updateChatMessages, arg.Messages, arg.ID)
	return err
}
